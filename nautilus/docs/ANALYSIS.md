# Nautilus Analysis: AWS Nitro Requirements

**Date:** 2025-11-11
**Analyzed by:** Nikola
**Repositories examined:**
- https://github.com/MystenLabs/nautilus
- https://github.com/MystenLabs/nautilus-twitter

---

## Key Finding: AWS Nitro IS REQUIRED ❌

After examining both repositories, **Nautilus cannot run without AWS Nitro Enclaves**. Here's why:

---

## Technical Dependencies

### 1. **Hardcoded AWS Nitro Libraries**

From `nautilus-framework/src/aws/Cargo.toml`:
```toml
nsm_lib = { git = "https://github.com/aws/aws-nitro-enclaves-nsm-api.git/" }
nsm_api = { git = "https://github.com/aws/aws-nitro-enclaves-nsm-api.git/" }
```

These are **AWS Nitro Secure Module (NSM)** libraries that:
- Generate attestation documents (proof of TEE execution)
- Access enclave-specific hardware security features
- Only work inside actual Nitro Enclaves

### 2. **Attestation Document Generation**

The core security feature of Nautilus is the **attestation document**:
- Generated by AWS Nitro hardware
- Contains PCR (Platform Configuration Register) values
- Cryptographically signed by AWS as the root CA
- **Cannot be mocked or simulated locally**

From `Design.md`:
> The attestation document from an AWS Nitro Enclave includes a certificate chain that can be verified onchain using AWS as the root certificate authority.

### 3. **Enclave Image Format (EIF)**

Nautilus builds into an **EIF binary** which:
- Only runs inside AWS Nitro Enclaves
- Requires `eif_build` tool (AWS-specific)
- Cannot be executed as a regular Docker container or binary

From `Containerfile`:
```dockerfile
FROM stagex/user-eif_build@sha256:... AS user-eif_build
FROM stagex/user-linux-nitro@sha256:... AS user-linux-nitro
```

### 4. **No Internet Access Inside Enclave**

Enclaves have **no direct internet access**:
- Parent EC2 instance acts as a proxy
- Traffic forwarding is configured via `allowed_endpoints.yaml`
- This architecture cannot be replicated locally

---

## What You CAN'T Do Locally

❌ **Generate real attestation documents**
❌ **Run the EIF binary outside Nitro**
❌ **Test PCR verification on-chain**
❌ **Demonstrate reproducible builds**
❌ **Prove TEE security guarantees**

---

## What You CAN Do Without AWS

### Option 1: Mock Backend (NOT Real Nautilus)

You can build a **regular Rust + Axum backend** that:
- ✅ Implements similar API endpoints (`process_data`, `get_attestation`)
- ✅ Returns mock signed responses
- ✅ Tests integration with other components (Cetus, Escrow, Walrus)
- ❌ **BUT**: No real TEE, no attestation, no security guarantees

**Implementation:**
```rust
// nautilus/src/main.rs (MOCK VERSION)
use axum::{Json, Router, routing::post};

#[tokio::main]
async fn main() {
    let app = Router::new()
        .route("/process_data", post(process_data))
        .route("/get_attestation", post(mock_attestation));

    axum::Server::bind(&"0.0.0.0:8080".parse().unwrap())
        .serve(app.into_make_service())
        .await
        .unwrap();
}

async fn process_data(Json(payload): Json<Value>) -> Json<Value> {
    // Mock computation logic
    json!({
        "signature": "mock_signature",
        "data": { /* computed result */ }
    })
}

async fn mock_attestation() -> Json<Value> {
    // Return fake attestation (clearly marked as mock)
    json!({
        "mock": true,
        "message": "This is a mock attestation for demo purposes"
    })
}
```

### Option 2: AWS Setup (Real Nautilus)

To use **real Nautilus**, you must:

**Step 1: AWS Account Setup**
- AWS account with payment method
- AWS CLI configured
- Key pair created

**Step 2: Launch EC2 Instance**
```bash
export KEY_PAIR=<your-key-pair>
export AWS_ACCESS_KEY_ID=<your-key>
export AWS_SECRET_ACCESS_KEY=<your-secret>
export AWS_SESSION_TOKEN=<your-token>

sh configure_enclave.sh weather-example
```

**Step 3: Deploy Enclave**
- Script launches EC2 instance (c6a.xlarge ~$0.17/hr)
- Builds EIF binary
- Runs enclave
- Configures traffic forwarding

**Step 4: Register On-Chain**
```bash
sh register_enclave.sh
```

**Cost Estimate:**
- EC2 instance: ~$0.17/hr × 8hr = **$1.36/day**
- Sui gas: negligible (testnet faucet)

---

## Recommendations for Hackathon

### Recommended: Hybrid Approach

**Days 1-3: Build without AWS**
- Use **mock backend** to test integration
- Implement Cetus DEX, Escrow, Intent system
- Get end-to-end flow working with mock attestation
- Mark clearly as "MOCK TEE" in UI

**Day 4: Add Real Nautilus (If Time Permits)**
- Set up AWS account
- Deploy real enclave
- Replace mock with real attestation
- Demo both versions to judges

### Demo Strategy

**What to show judges:**
1. **Working integration**: Mock backend proves the architecture works
2. **Understanding**: Explain why Nautilus > Encifher (self-managed, verifiable)
3. **Reproducibility**: Show how PCR values would work (even if mocked)
4. **Future plan**: "With AWS, this becomes a real TEE"

**Script:**
> "We've implemented a mock Nautilus backend to demonstrate the integration architecture. In production, this would run inside AWS Nitro Enclaves with real attestation verification. The key advantage over Encifher is that anyone can verify our TEE by rebuilding the binary and checking PCR values on-chain."

---

## Project Structure Decision

### Option A: Mock Only (Safer for Hackathon)

```
nautilus/
├── src/
│   └── main.rs              # Mock Axum server
├── Cargo.toml
└── README.md                # Clearly states "MOCK"
```

**Pros:**
- ✅ Fast development
- ✅ No AWS costs/complexity
- ✅ Focus on integration
- ✅ Still demonstrates concept

**Cons:**
- ❌ Not real TEE
- ❌ Less impressive

### Option B: Keep Both (Best of Both Worlds)

```
nautilus/
├── mock-backend/            # For Days 1-3
│   ├── src/
│   │   └── main.rs
│   └── Cargo.toml
├── nautilus-framework/      # Real Nautilus (from GitHub)
├── nautilus-twitter-example/
└── README.md                # Explains both versions
```

**Pros:**
- ✅ Work immediately with mock
- ✅ Real Nautilus ready if time permits
- ✅ Shows understanding of both

**Cons:**
- ⚠️ More complex repo structure

---

## Final Answer to Your Question

> "Do we really have to set up AWS or can we run a simple backend?"

**Answer:** You can run a simple backend for the **hackathon demo**, but it won't be real Nautilus. Real Nautilus **requires AWS Nitro Enclaves** due to:
1. Hardware attestation generation
2. EIF binary format
3. Enclave security features
4. On-chain verification needs real AWS signatures

**Recommendation:** Start with mock backend, add real AWS on Day 4 if ahead of schedule.

---

## Next Steps

### Immediate (Today):
1. ✅ Decision: Mock or AWS setup?
2. Create mock backend structure if going mock route
3. Review weather-example code pattern
4. Plan API endpoints for intent processing

### Day 4 (If AWS Route):
1. AWS account setup
2. Run `configure_enclave.sh`
3. Deploy enclave
4. Test attestation
5. Register on-chain

---

## Resources

- **AWS Nitro Guide:** https://docs.aws.amazon.com/enclaves/latest/user/getting-started.html
- **Nautilus Docs:** https://docs.sui.io/concepts/cryptography/nautilus
- **Discord:** #nautilus in Sui Discord for questions

---

**Conclusion:** Mock backend is acceptable for hackathon. Real AWS gives you bonus points but adds complexity. Your call based on time/resources available.
